(function(b){var a=function(e,d){var c=this;d=d||{};c.element=e;c.options=b.extend({},c.options,d);c._check();c._bind()};a.prototype={options:{checkurl:"/reserveapi/checkExists",checkurl_param_ids_key:"msg_ids",checkurl_render_id_key:"id",addurl:"/reserveapi/add",addurl_param_id_key:"res_id",cancelurl:"/reserveapi/del",cancelurl_param_id_key:"res_id",btn_selector:"._reserve_btn",icon_class_has:"fa-star",icon_class_none:"fa-star-o",icon_class_loading:"fa-spinner fa-spin"},STATES:{HAS:1,LOADING:2,NOHAS:3},element:null,_check:function(){var e=this,f=e.options,c=e.STATES;var h=b(f.btn_selector,e.element);var g=[];b.each(h,function(j){var k=b(this);var l=k.data("supply_id")||0;if(l>0){g.push(l)}});do{var i=g.join(",");if(i.length==0){break}if(!isLogin()){break}var d={};d[f.checkurl_param_ids_key]=i;b.get(f.checkurl,d,Main.td_callback_proxy(function(k){var j={};do{if(k.label!="success"){break}b.each(k.info,function(n,l){var m=l[f.checkurl_render_id_key];j["msg_id_"+m]=l.exists=="true"?c.HAS:c.NOHAS});b.each(h,function(){var l=b(this);var m=l.attr("data-supply_id");e._set(l,j["msg_id_"+m])})}while(false)}),"jsonp")}while(false)},_set_state:function(e,f){var d=this,c=d.STATES;if(f==c.HAS){f=c.HAS}else{if(f==c.NOHAS){f=c.NOHAS}else{if(f==c.LOADING){f=c.LOADING}else{f=c.NOHAS}}}e.attr("data-state",f)},_get_state:function(e){var g=b(e),d=this,c=d.STATES;var f=g.attr("data-state");if(typeof(f)=="string"){f=f.toLowerCase()}if(f==c.HAS){f=c.HAS}else{if(f==c.NOHAS){f=c.NOHAS}else{if(f==c.LOADING){f=c.LOADING}else{f=c.NOHAS}}}return f},_set_icon:function(f){var d=this,c=d.STATES,e=d.options;var g=d._get_state(f);if(g==c.HAS){e.icon_class_has&&f.addClass(e.icon_class_has);e.icon_class_none&&f.removeClass(e.icon_class_none);e.icon_class_loading&&f.removeClass(e.icon_class_loading)}else{if(g==c.LOADING){e.icon_class_has&&f.removeClass(e.icon_class_has);e.icon_class_none&&f.removeClass(e.icon_class_none);e.icon_class_loading&&f.addClass(e.icon_class_loading)}else{e.icon_class_has&&f.removeClass(e.icon_class_has);e.icon_class_none&&f.addClass(e.icon_class_none);e.icon_class_loading&&f.removeClass(e.icon_class_loading)}}},_set:function(e,f){var c=this,d=c.options;c._set_state(e,f);c._set_icon(e);if(b.isFunction(d.set_callback)){d.set_callback.call(c,e)}},_bind:function(){var d=this,e=d.options,c=d.STATES;b(d.element).delegate(e.btn_selector,"click",function(){if(b(".glyphicon-user").attr("isBindPhone")==1){showBind();initBindPhone();ListenBindBtn();return}var g=b(this);var h=d._get_state(g);var i=g.attr("data-supply_id")||0;do{if(i<1){break}d._set(g,c.LOADING);if(h==c.NOHAS){var f={};f[e.addurl_param_id_key]=i;b.get(e.addurl,f,Main.td_callback_proxy(function(j){do{if(j.name=="error.nopower"){d._set(g,c.NOHAS);showLogin();break}if(j.label!="success"){d._set(g,c.NOHAS);showMsg(j.label,j.brief);break}d._set(g,c.HAS)}while(false)}),"jsonp")}else{if(h==c.HAS){var f={};f[e.cancelurl_param_id_key]=i;b.get(e.cancelurl,f,Main.td_callback_proxy(function(j){do{if(j.name=="error.nopower"){d._set(g,c.HAS);showLogin();break}if(j.label!="success"){d._set(g,c.HAS);showMsg(j.label,j.brief);break}d._set(g,c.NOHAS)}while(false)}),"jsonp")}}}while(false);return false})},recheck:function(){var c=this;c._check()}};b.fn.extend({quick_reserve:function(c,d){var e=this;if(c&&typeof(c)=="string"&&c.length!=0&&c.slice(0,1)!="_"){d=c;c={}}else{if(typeof(c)=="object"){d=false}else{c={};d=false}}b.each(e,function(){var h=this;var i=b(this);if(!i.data("quick_reserve")){var f=b.extend({checkurl:"/reserveapi/checkExists",checkurl_param_ids_key:"msg_ids",checkurl_render_id_key:"id",addurl:"/reserveapi/add",addurl_param_id_key:"msg_id",cancelurl:"/reserveapi/del",cancelurl_param_id_key:"msg_id",btn_selector:"._reserve_btn",icon_class_has:"fa-star",icon_class_none:"fa-star-o",icon_class_loading:"fa-spinner fa-spin"},c);var g=new a(i,f);if(d&&typeof(g[d])=="function"){g[d]()}i.data("quick_reserve",g)}else{if(d&&typeof(i.data("quick_reserve")[d])=="function"){i.data("quick_reserve")[d](c)}}})},quick_collect:function(c,d){var e=this;if(c&&typeof(c)=="string"&&c.length!=0&&c.slice(0,1)!="_"){d=c;c={}}else{if(typeof(c)=="object"){d=false}else{c={};d=false}}b.each(e,function(){var g=this;var h=b(this);if(!h.data("quick_collect")){var f=b.extend({checkurl:"/collectapi/checkexists",checkurl_param_ids_key:"res_ids",checkurl_render_id_key:"res_id",addurl:"/collectapi/add",addurl_param_id_key:"res_id",cancelurl:"/collectapi/del",cancelurl_param_id_key:"res_id",btn_selector:"._collect_btn",icon_class_has:"fa-heart",icon_class_none:"fa-heart-o",icon_class_loading:"fa-spinner fa-spin"},c);var i=new a(h,f);if(d&&typeof(i[d])=="function"){i[d]()}h.data("quick_collect",i)}else{if(d&&typeof(h.data("quick_collect")[d])=="function"){h.data("quick_collect")[d](c)}}})}})})(jQuery);$(function(){$("._quick_collect_box").quick_collect();$("._quick_reserve_box").quick_reserve()});