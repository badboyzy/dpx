(function(j,k,e,g){var b={0:{name:"中山",id:"4420",parent:"44",type:"2"},1:{name:"江门",id:"4407",parent:"44",type:"2"},2:{name:"珠海",id:"4404",parent:"44",type:"2"},3:{name:"佛山",id:"4406",parent:"44",type:"2"},4:{name:"广州",id:"4401",parent:"44",type:"2"},5:{name:"肇庆",id:"4402",parent:"44",type:"2"},6:{name:"清远",id:"4418",parent:"44",type:"2"},7:{name:"惠州",id:"4413",parent:"44",type:"2"}};var h=[,'<div class="fclose"><a href="javascript:areaSelectAction.close(\'<#=id #>\');void(0);"><b>关闭</b></a></div>','<div class="ftitle">','<h4 class="divleft">热点城市</h4>',"</div>",'<hr class="dashed" />','<div class="fcontent">',"<# for(var key in hotCity){ var item=hotCity[key]; #>",'<div class="item hot"><a href=\'javascript:areaSelectAction.select("<#=id #>",<#=item["id"] #>,<#=JSON.stringify(item) #>);void(0);\'><#= item["name"] #></a></div>',"<# } #>","</div>",'<div class="ftitle hidden">','<h6 class="divleft">地区快速筛选：</h6>','<input type="text" class="text middletxt" onkeyup=\'areaSelectAction.drawSearchList("<#=id #>",this)\' />',"</div>",'<hr class="dashed" />','<div class="ftitle">',"<span>","<# for(var key in paths){ var item=paths[key]; #>",'<span><a href=\'javascript:areaSelectAction.select("<#=id #>",<#=item["id"] #>,<#=JSON.stringify(item) #>);void(0);\'><#= item["name"] #></a></span> &gt; ',"<# }#>","</span>","<# if(paths && paths.length>1){ #>",'<a href=\'javascript:areaSelectAction.select("<#=id #>",<# var upitem=paths[paths.length-2]; upitem?echo(upitem["id"]):echo(0); #>,<#=JSON.stringify(upitem?upitem:paths[0]) #>);void(0);\'> 返回上一级</a>',"<# }#>","</div>",'<div class="fcontent">',"<# for(var key in citys){ var item=citys[key]; #>",'<div class="item"><a href=\'javascript:areaSelectAction.select("<#=id #>",<#=item["id"] #>,<#=JSON.stringify(item) #>);void(0);\'><#= item["name"] #></a></div>','<# } if(!citys){echo("加载中...");} #>',"</div>"].join("\n");var d=g(h);var n=[,'<ul class="list">',"<# for(var key in list){var item=list[key]; #>","<li>",'<a href=\'javascript:areaSelectAction.select("<#=id#>",<#=item["id"] #>,<#=JSON.stringify(item) #>);areaSelectAction.closeList("<#=id#>");void(0);\'>','<#=item["name"] #>',"</a>","</li>","<# } #>","</ul>"].join("");var i=g(n);var c="/regionapi/linkage";var p="/regionapi/search";var a={};var o="";j.areaSelectAction={close:function(s){var r=a[s];var q=r.mainFrame;q.hide();j.areaSelectAction.closeList(s)},select:function(s,u,t){var r=a[s];if(r.option.max_code_len==6||o!=""){var q=String(u).substr(0,4);if((q=="4420"||q=="4419")){o=o?o:r.option.max_code_len;r.option.max_code_len=9}else{if(o=="6"){r.option.max_code_len=6}}}m(s,u);r.selectItem=t;r.option.area_id=t.id;r.option.after_selected.call(r)},show_result:function(s,t,r,u){var q=a[s];q.selectItem=t;q.items=r;q.paths=u;q.option.show_result.call(q);if(q.initshow===false&&r.length<1){q.option.sumit.call(q);q.close()}q.initshow=false},sumit:function(r){var q=a[r];q.option.sumit.call(q);q.close()},drawSearchList:l,closeList:function(r){var q=a[r];q.searchList.hide()}};function m(r,t){var q=a[r];var u=new Array();var s=new Array();u.push({name:"全国",id:"0",subdomain:"www"});q.mainFrame.html(d({hotCity:b,citys:null,paths:null,id:r}));e.ajax({type:"GET",dataType:"json",cache:true,url:c,data:{id:t,isInit:1},success:function(y){for(var x in y){if(!y.hasOwnProperty(x)){continue}if(y[x]["selected"]){u.push(y[x]["selected"])}}var v=a[r];var z=u[u.length-1];for(var w=u.length-1;w>=0;w--){if(v.option.max_code_len>0&&v.option.max_code_len<z.id.length){if(u[w].id.length==v.option.max_code_len){m(r,u[w].id);return}}if(v.option.have_subdomain&&!z.subdomain){if(u[w].subdomain!=""&&u[w].subdomain!=null){m(r,u[w].id);return}}}v.mainFrame.html(d({hotCity:b,citys:null,paths:u,id:r}));e.ajax({type:"GET",dataType:"json",cache:true,url:c,data:{id:t,isInit:0},success:function(B){for(var A in B){if(!B.hasOwnProperty(A)){continue}var C=B[A];if(C.id.length>v.option.max_code_len&&v.option.max_code_len>0){break}if(v.option.have_subdomain){if(!C.subdomain||C.subdomain===""){continue}}s.push(C)}v.mainFrame.html(d({hotCity:b,citys:s,paths:u,id:r}));areaSelectAction.show_result(r,u[u.length-1],s,u);e(v).trigger("blur")}})}})}function l(r,q){if(q.value.length<1){j.areaSelectAction.closeList(r);return}e.ajax({type:"GET",dataType:"json",cache:true,url:p,data:{name:q.value},success:function(u){var s=a[r];var x=new Array();for(var t in u){if(!u.hasOwnProperty(t)){continue}var v=u[t];if(v.id.length>s.option.max_code_len&&s.option.max_code_len>0){break}if(s.option.have_subdomain){if(!v.subdomain||v.subdomain===""){continue}}x.push(v)}if(x.length<1){j.areaSelectAction.closeList(r);return}var w=e(q);s.searchList.html(i({list:x,id:r}));s.searchList.show();s.searchList.css({left:w.offset().left,top:w.outerHeight()+w.offset().top,width:w.width()})}})}var f=0;e.fn.areaSelect=function(q){var r={query_id:"name",init:null,after_selected:function(){},sumit:function(){},show_result:function(){},max_code_len:0,area_id:0,have_subdomain:false};e.extend(r,q);e.each(this,function(v,t){var y=e(t);t.option={};e.extend(t.option,r);if(!t.option.area_id){t.option.area_id=y.data("area_id")}var u=y.attr("id");if(!u){f++;u="areaSelect_item_"+f}y.attr("id",u);a[u]=t;t.option={};e.extend(t.option,r);if(!t.option.area_id){var x=y.data("area_id");t.option.area_id=x?x:0}var s=e('<div class="areaSelect"></div>');t.mainFrame=s;e("body").append(t.mainFrame);t.mainFrame.css({position:"absolute"});t.mainFrame.hide();var w=e('<div class="areaSearchList"></div>');t.searchList=w;e("body").append(t.searchList);t.searchList.css({position:"absolute"});t.searchList.hide();t.getPaths=function(){var A=new Array();if(!t.paths){return A}for(var z=1;t.paths.length-1>z;z++){A.push(t.paths[z])}return A};t.close=function(){areaSelectAction.close(u)};t.show_result=function(){t.option.show_result.call(this)};t.sumit=function(){t.option.sumit.call(this);t.close()};t.after_selected=function(){t.option.after_selected.call(this)};y.click(function(){var z=this;var D=e(z);var B=D.attr("id");z.initshow=true;m(B,z.option.area_id);for(var A in a){if(!a.hasOwnProperty(A)){continue}var C=a[A];if(C){C.mainFrame.hide()}}z.mainFrame.show();z.mainFrame.css({left:D.offset().left,top:D.offset().top+D.outerHeight()})});e(j).load(function(){y.click();s.hide()})})}})(window,document,window.jQuery,window.tpl);(function(a){a(function(){window.select_area_id_bind=function(c){var b;if(c){b=a(c)}else{b=a("._selector_area_id")}var d='<input type="text" class="_selectArea text" readonly /><button type="button" class="_select_area_btn" data-area_id="650" data-show_result="1" data-type="4" data-have_subdomain="1">选择</button>';a.each(b,function(j,k){if(k.binded){return}else{k.binded=true}var i=a(k);var f=a(["<span>",d,"</span>"].join("\n"));i.before(f);f.append(i);var m=i;var e=f.find("._selectArea");var g=f.find("._select_area_btn");var h={query_id:"name",sumit:null,show_result:1,max_code_len:0,area_id:0,have_subdomain:false};for(var j in h){if(!h.hasOwnProperty(j)){continue}var l=m.data(j);if(typeof(l)!="undefined"){h[j]=l}}if(h.have_subdomain==1||h.have_subdomain=="1"){h.have_subdomain=true}else{h.have_subdomain=false}if(h.show_result===1||h.show_result==="1"){h.show_result=function(){var n=this;var r=a(n);e.val("");var q=n.getPaths();for(var o in q){if(!q.hasOwnProperty(o)){continue}e.val(e.val()+q[o].name+" ")}if(n.selectItem){e.val(e.val()+n.selectItem.name)}var p=m;p.val(n.selectItem.id);p.blur()}}else{h.show_result=function(){}}h.sumit=function(){var n=this;n.close()};e.areaSelect(h);g.click(function(){e.click()})})};select_area_id_bind()})})(window.jQuery);